with holiday_v_subdivisions_cte as( select tb1.uuid , tb1.name as holiday_name , tb1.date as holiday_date , tb1.observed as holiday_observed , tb1.country , tb2.subdivisions as subdivision_code from holidays tb1 join holidays_subdivisions tb2 on tb1.uuid = tb2.uuid) select hs.*, l.location_id from holiday_v_subdivisions_cte hs join locations l on (hs.country = l.country_code and hs.subdivision_code = l.subdivision_code) where l.location_id = '{location_id_params}' and holiday_observed BETWEEN '{date_range_start}' AND '{date_range_end}';